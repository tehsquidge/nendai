(function(f,c,a,i){var h=new Date(),e="nendai",g={containerName:"nendai-calendar",container:null,day:h.getDate(),month:h.getMonth()+1,year:h.getFullYear(),type:"default",minYear:null,minMonth:null,minDay:1,maxYear:null,maxMonth:null,maxDay:1};function b(j,d){this.element=j;this.options=f.extend({},g,d);this._defaults=g;this._name=e;this.init()}b.prototype={init:function(){var d=this;if(f("#"+d.options.containerName).length==0){f("body").append('<div id="'+d.options.containerName+'"></div>')}d.container=f("#"+d.options.containerName);d.container.hide();f(d.element).focus(function(){d.generateCalendar(d)});d.updateInput(d)},generateCalendar:function(d){d.container.show();var n=f(d.element).offset().top+f(d.element).outerHeight();var m=f(d.element).offset().left;d.container.offset({top:n,left:m});d.updateInput(d);var k=d.options.year;var l=d.options.month;var j=d.options.day;d.container.html("");if(d.options.type=="month"){d.container.addClass("month-mode")}else{d.container.removeClass("month-mode")}d.container.append("<div class='nendai-spinner' id='nendai-year-spinner'><label>Year</label><a class='increment nendai-button' href='#'>+</a><div class='value'>"+k+"</div><a class='decrement nendai-button' href='#'>&#8722;</a></div>");d.container.append("<div class='nendai-spinner' id='nendai-month-spinner'><label>Month</label><a class='increment nendai-button' href='#'>+</a><div class='value'>"+l+"</div><a class='decrement nendai-button' href='#'>&#8722;</a></div>");if(d.options.type!="month"){d.container.append("<div class='nendai-spinner' id='nendai-day-spinner'><label>Day</label><a class='increment nendai-button' href='#'>+</a><div class='value'>"+j+"</div><a class='decrement nendai-button' href='#'>&#8722;</a></div>")}d.container.append("<div class='nendai-dialog-controls'><a class='accept nendai-button'>Accept</a><a class='cancel nendai-button'>Cancel</a></div>");d.container.children("#nendai-year-spinner").children(".increment").click(function(o){o.preventDefault();if(f(this).hasClass("disabled")){return}d.changeYear(d,1);d.validateDateRange(d)});d.container.children("#nendai-year-spinner").children(".decrement").click(function(o){o.preventDefault();if(f(this).hasClass("disabled")){return}d.changeYear(d,-1);d.validateDateRange(d)});d.container.children("#nendai-month-spinner").children(".increment").click(function(o){o.preventDefault();if(f(this).hasClass("disabled")){return}d.changeMonth(d,1);d.validateDateRange(d)});d.container.children("#nendai-month-spinner").children(".decrement").click(function(o){o.preventDefault();if(f(this).hasClass("disabled")){return}d.changeMonth(d,-1);d.validateDateRange(d)});d.container.children("#nendai-day-spinner").children(".increment").click(function(o){o.preventDefault();if(f(this).hasClass("disabled")){return}d.changeDay(d,1);d.validateDateRange(d)});d.container.children("#nendai-day-spinner").children(".decrement").click(function(o){o.preventDefault();if(f(this).hasClass("disabled")){return}d.changeDay(d,-1);d.validateDateRange(d)});d.container.find(".accept").click(function(){d.storeDate(d);d.updateInput(d);d.clearCalendar(d);d.container.hide()});d.container.find(".cancel").click(function(){d.clearCalendar(d);d.container.hide()})},clearCalendar:function(d){d.container.html("")},changeYear:function(d,k){var j=d.getSpinnerYear(d)+k;d.setSpinnerYear(d,j)},changeMonth:function(d,l){var k=d.getSpinnerMonth(d)+l;if(k>12){k=1;d.changeYear(d,1)}if(k<1){k=12;d.changeYear(d,-1)}var j=new Date(d.getSpinnerYear(d),k,1,-1).getDate();if(j<d.getSpinnerDay(d)){d.setSpinnerDay(d,j)}d.setSpinnerMonth(d,k)},changeDay:function(d,l){var k=d.getSpinnerDay(d)+l;var j=new Date(d.getSpinnerYear(d),d.getSpinnerMonth(d),1,-1).getDate();if(k>j){k=1;d.changeMonth(d,1)}if(k<1){d.changeMonth(d,-1);k=new Date(d.getSpinnerYear(d),d.getSpinnerMonth(d),1,-1).getDate()}d.setSpinnerDay(d,k)},storeDate:function(d){d.options.year=d.getSpinnerYear(d);d.options.month=d.getSpinnerMonth(d);d.options.day=d.getSpinnerDay(d)},getSpinnerYear:function(d){return parseInt(d.container.children("#nendai-year-spinner").children(".value").html())},getSpinnerMonth:function(d){return parseInt(d.container.children("#nendai-month-spinner").children(".value").html())},getSpinnerDay:function(d){var j=parseInt(d.container.children("#nendai-day-spinner").children(".value").html());console.log(j);if(isNaN(j)){j=1}return j},setSpinnerYear:function(d,j){d.container.children("#nendai-year-spinner").children(".value").html(j)},setSpinnerMonth:function(d,j){d.container.children("#nendai-month-spinner").children(".value").html(j)},setSpinnerDay:function(d,j){d.container.children("#nendai-day-spinner").children(".value").html(j)},updateInput:function(d){if(d.options.type=="month"){f(d.element).val(d.options.year+"-"+d.options.month)}else{f(d.element).val(d.options.year+"-"+d.options.month+"-"+d.options.day)}},validateDateRange:function(s){var u=s.options.minYear;var q=s.options.minMonth;var l=s.options.minDay;var k=new Date(u,q-1,l);var o=s.options.maxYear;var j=s.options.maxMonth;var n=s.options.maxDay;var d=new Date(o,j-1,n);var m=s.getSpinnerYear(s);var r=s.getSpinnerMonth(s);var p=s.getSpinnerDay(s);var t=new Date(m,r-1,p);if(!(u==null||q==null)){if(k>=t){s.setSpinnerYear(s,u);s.setSpinnerMonth(s,q);s.setSpinnerDay(s,l)}}if(!(o==null||j==null)){if(d<=t){s.setSpinnerYear(s,o);s.setSpinnerMonth(s,j);s.setSpinnerDay(s,n)}}if(new Date(m-1,r-1,p)<=k){s.container.children("#nendai-year-spinner").children(".decrement").addClass("disabled")}else{s.container.children("#nendai-year-spinner").children(".decrement").removeClass("disabled")}if(new Date(m,r-2,p)<=k){s.container.children("#nendai-month-spinner").children(".decrement").addClass("disabled")}else{s.container.children("#nendai-month-spinner").children(".decrement").removeClass("disabled")}if(new Date(m,r-1,p)<=k){s.container.children("#nendai-day-spinner").children(".decrement").addClass("disabled")}else{s.container.children("#nendai-day-spinner").children(".decrement").removeClass("disabled")}if(new Date(m+1,r-1,p)>=d){s.container.children("#nendai-year-spinner").children(".increment").addClass("disabled")}else{s.container.children("#nendai-year-spinner").children(".increment").removeClass("disabled")}if(new Date(m,r,p)>=d){s.container.children("#nendai-month-spinner").children(".increment").addClass("disabled")}else{s.container.children("#nendai-month-spinner").children(".increment").removeClass("disabled")}if(new Date(m,r-1,p)>=d){s.container.children("#nendai-day-spinner").children(".increment").addClass("disabled")}else{s.container.children("#nendai-day-spinner").children(".increment").removeClass("disabled")}}};f.fn[e]=function(d){return this.each(function(){if(!f.data(this,"plugin_"+e)){var j=new b(this,d);f.data(this,"plugin_"+e,j)}})}})(jQuery,window,document);